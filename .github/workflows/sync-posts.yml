name: Sync Posts

on:
  push:
    paths:
      - 'ObsidianVault/**'
  workflow_dispatch:  # Allow manual triggering

jobs:
  sync:
    runs-on: windows-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Trigger Vercel API
        shell: pwsh
        run: |
          $uri = "${{ secrets.VERCEL_SYNC_URL }}"
          if (!$uri.StartsWith("https://")) {
            $uri = "https://" + $uri
          }
          $uri = $uri + "/api/sync"
          
          Write-Host "Calling URI: $uri"
          
          $response = Invoke-RestMethod -Method POST `
            -Uri $uri `
            -Headers @{
              "Authorization" = "Bearer ${{ secrets.SYNC_SECRET_TOKEN }}"
            } `
            -ErrorVariable responseError `
            -StatusCodeVariable statusCode
          
          Write-Host "Response: $response"
          Write-Host "Status code: $statusCode"
          
          if ($statusCode -ne 200) {
            Write-Error "Sync failed with status code: $statusCode"
            exit 1
          } 